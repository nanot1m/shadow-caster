(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))h(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&h(f)}).observe(document,{childList:!0,subtree:!0});function g(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function h(r){if(r.ep)return;r.ep=!0;const c=g(r);fetch(r.href,c)}})();const d=16,A=20,M=20;function J(n,t,g){const h=n.getContext("2d"),r=window.devicePixelRatio||1;n.width=t*r,n.height=g*r,n.style.width=`${t}px`,n.style.height=`${g}px`,h.scale(r,r)}function Q(n,t){return{edgeIds:[0,0,0,0],existEdges:[!1,!1,!1,!1],x:n,y:t}}const C=0,w=1,T=2,L=3,V=n=>{let t=!1,g=!1;return Object.assign(()=>{t?g=!0:n()},{lock(){t=!0},unlock(){t=!1,g&&n(),g=!1},isTransaction(){return t}})};function k(n){J(n,d*A,d*M);const t=n.getContext("2d");let g=!1,h=!1,r=null,c=performance.now(),f=0,y=0;const u=V(H),{hasCell:x,getCell:I,setCell:p,getAllCells:O}=new Proxy(ee(),{get(e,o){return o==="setCell"?(l,i,s)=>{e.setCell(l,i,s),u()}:e[o]}}),{getEdge:m,addEdge:S,getAllEdges:$,clearEdges:D}=te(),E=[];u.lock();for(let e=0;e<A;e++)p(e,0,!0),p(e,M-1,!0);for(let e=0;e<M;e++)p(0,e,!0),p(A-1,e,!0);u.unlock(),Y(performance.now());function H(){D();for(let e=0;e<A;e++)for(let o=0;o<M;o++){const l=I(e,o);if(l){if(x(e,o-1))l.existEdges[C]=!1,l.edgeIds[C]=0;else{l.existEdges[C]=!0;const i=I(e-1,o);if(i&&i.existEdges[C]){const s=i.edgeIds[C],a=m(s);l.edgeIds[C]=s,a.ex=e+1}else{const s=S({sx:e,sy:o,ex:e+1,ey:o});l.edgeIds[C]=s}}if(x(e+1,o))l.existEdges[w]=!1,l.edgeIds[w]=0;else{l.existEdges[w]=!0;const i=I(e,o-1);if(i&&i.existEdges[w]){const s=i.edgeIds[w],a=m(s);l.edgeIds[w]=s,a.ey=o+1}else{const s=S({sx:e+1,sy:o,ex:e+1,ey:o+1});l.edgeIds[w]=s}}if(x(e,o+1))l.existEdges[T]=!1,l.edgeIds[T]=0;else{l.existEdges[T]=!0;const i=I(e-1,o);if(i&&i.existEdges[T]){const s=i.edgeIds[T],a=m(s);l.edgeIds[T]=s,a.ex=e+1}else{const s=S({sx:e,sy:o+1,ex:e+1,ey:o+1});l.edgeIds[T]=s}}if(x(e-1,o))l.existEdges[L]=!1,l.edgeIds[L]=0;else{l.existEdges[L]=!0;const i=I(e,o-1);if(i&&i.existEdges[L]){const s=i.edgeIds[L],a=m(s);l.edgeIds[L]=s,a.ey=o+1}else{const s=S({sx:e,sy:o,ex:e,ey:o+1});l.edgeIds[L]=s}}}}}function U(){if(E.length=0,!r)return;const e=new Set,o=$(),[l,i]=r;for(const s of o){const a=s.sx*d,P=s.sy*d,R=s.ex*d,N=s.ey*d;for(let b=0;b<2;b++){let v=b===0?a:R,_=b===0?P:N;const q=`${v},${_}`;if(!e.has(q)){e.add(q);const W=Math.atan2(_-i,v-l);for(let F=0;F<3;F++){const X=W+(F-1)*1e-4;v=l+Math.cos(X)*A*d*1.5,_=i+Math.sin(X)*M*d*1.5;const Z={sx:l,sy:i,ex:v,ey:_,angle:X};E.push(Z)}}}}for(const s of E)for(const a of o){const P=se(s.sx,s.sy,s.ex,s.ey,a.sx*d,a.sy*d,a.ex*d,a.ey*d);if(P){const{x:R,y:N}=P,b=(R-l)**2+(N-i)**2,v=(s.ex-l)**2+(s.ey-i)**2;b<v&&(s.ex=R,s.ey=N)}}E.sort((s,a)=>s.angle-a.angle)}n.addEventListener("mousemove",e=>{const{offsetX:o,offsetY:l}=e,i=Math.floor(o/d),s=Math.floor(l/d);g&&p(i,s,!0),h&&p(i,s,!1),r=[o,l],U()}),n.addEventListener("mouseleave",()=>{r=null}),n.addEventListener("mousedown",e=>{const{offsetX:o,offsetY:l}=e,i=Math.floor(o/d),s=Math.floor(l/d);if(e.button===2)return;const a=x(i,s);h=a,g=!a,p(i,s,!x(i,s))}),window.addEventListener("mouseup",()=>{h=!1,g=!1});function Y(e){B(),f=performance.now()-e,y=1e3/(e-c),c=e,requestAnimationFrame(Y)}function B(){t.clearRect(0,0,n.width,n.height),z(),G(),K(),j()}function K(){r&&(t.save(),t.fillStyle="yellow",t.globalAlpha=1,t.font=d+"px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillText("ðŸŒž",r[0],r[1]),t.restore())}function j(){t.globalAlpha=1,t.font="10px sans-serif",t.fillStyle="white",t.fillText(`RT: ${f.toFixed(2)}ms; RC: ${E.length}; FPS: ${y.toFixed(0)}`,10,10)}function z(){for(const{x:e,y:o}of O())t.fillStyle="#4c6ef5",t.globalAlpha=1,t.fillRect(e*d,o*d,d,d)}function G(){if(E.length<1)return;const e=new Path2D;e.moveTo(E[0].ex,E[0].ey);for(let s=1;s<E.length;s++)e.lineTo(E[s].ex,E[s].ey);e.closePath(),t.save(),t.clip(e,"nonzero");const[o,l]=r??[0,0],i=t.createRadialGradient(o,l,0,o,l,100);i.addColorStop(0,"rgba(255, 255, 255, 1)"),i.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=i,t.globalAlpha=.8,t.beginPath(),t.arc(o,l,100,0,Math.PI*2),t.fill(),t.restore()}}function ee(){const n=new Map;function t(c,f){var y;return((y=n.get(c))==null?void 0:y.has(f))??!1}function g(c,f){var y;return(y=n.get(c))==null?void 0:y.get(f)}function h(c,f,y){var u,x;y?(n.has(c)||n.set(c,new Map),(u=n.get(c))==null||u.set(f,Q(c,f))):(x=n.get(c))==null||x.delete(f)}function r(){const c=[];for(const f of n.values())for(const y of f.values())c.push(y);return c}return{hasCell:t,getCell:g,setCell:h,getAllCells:r}}function te(){const n=new Map;let t=1;function g(){return t++}function h(u){return n.get(u)}function r(u){const x=g();return n.set(x,u),x}function c(u){return n.has(u)}function f(){return Array.from(n.values())}function y(){n.clear(),t=1}return{getEdge:h,addEdge:r,hasEdge:c,clearEdges:y,getAllEdges:f}}function se(n,t,g,h,r,c,f,y){const u=g-n,x=h-t,I=f-r,p=y-c,O=(-x*(n-r)+u*(t-c))/(-I*x+u*p),m=(I*(t-c)-p*(n-r))/(-I*x+u*p);if(O>=0&&O<=1&&m>=0&&m<=1){const S=n+m*u,$=t+m*x;return{x:S,y:$}}return null}document.querySelector("#app").innerHTML=`
  <canvas id="canvas"></canvas>
`;k(document.querySelector("#canvas"));
